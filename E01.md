# D'abord des nouvelles notions

## .htaccess

Voici un exemple de configuration dans un fichier `.htaccess` permettant la réécriture d'URL :

```

RewriteEngine On
RewriteRule ^user$ index.php?page=user [L]

```

> :hand: On placera le fichier `.htaccess` au même endroit que le fichier `index.php`.
Ce sont des directives Apache, qui veulent dire :

* `RewriteEngine On` : Active la réécriture.

* `RewriteRule` : Applique la règle de réécriture qui suit.
Pour chaque `RewriteRule`, on indique d'abord le type d'URL, puis à quoi doit correspondre cet URL.
Le premier élément derrière l'instrution Apache, `^user$`, est une expression régulière, on en parle plus bas. Le second élément est l'URL à réécrire par Apache. Ce procédé permet d'avoir des URL propres et de traiter un ou plusieurs paramètres en GET du côté de PHP.
Le dernier élément, `[L]`, est un «flag». Il y en a plusieurs mais nous n'utiliserons que celui-ci. Il indique à Apache que si l'URL de la requête correspond à cette ligne, il n'y aura pas d'autres règles de réécriture à traiter.

## Les expressions régulières

Les RegEx (Regular Expressions) sont une manière très puissante pour définir un motif à retrouver dans une chaine, soit pour l'extraire, soit pour vérifier qu'on retrouve ce schéma (vérifier la présence d'un mot, la conformité d'un numéro de téléphone ou de carte bancaire, etc.).
Soit la règle de réécriture suivante :

```
RewriteEngine On
RewriteRule ^user\/(\d+)$ index.php?controller=user&id=$1 [L]
```

* `^user\/` : Pour toute chaine (URL) qui commence par `user/` (`^` est le symbole indiquant le début de la chaine)
* `\d+` : Qui contient un ou plusieurs chiffres (d = digit = nombre).
* `(\d+)` => capture-moi ce groupe de chiffres.
* `$` : la regex se termine ici, symbole de fin de la chaine.
* `index.php?controller=user&id=$1` : Redirige vers la page index.php avec les paramètres GET indiqués et le premier groupe capturé en `$1`
* Cela renverra `user/3` vers `index.php?controller=user&id=3`, ce qui nous permettrait d'appeler le contrôleur `UserController` par exemple, en lui transmettant un tableau associatif de paramètres, ici `['id' => 3];` Un peu comme le ferait AltoRouter mais grâce à la réécriture.
Ici la RegEx sert à vérifier si l'URL ressemble à ce **motif**, et si c'est le cas, on va extraire la partie ne contenant que des chiffres pour l'envoyer en paramètre GET à notre fichier `index.php`.
=> Pour continuer sur cette lancée, **voici un petit jeu pour s'initier à cette syntaxe bien velue**, mais tellement puissante :heart: [RegexOne](https://regexone.com). Essayez d'avancer le plus loin possible :wink: *checkez le récap' à droite*

=> Pour tester vos expressions régulières et affiner votre compréhension, vous pouvez également allez faire un tour sur [regex101](https://regex101.com/) (essayer d'y mettre celle de l'exemple, `^user\/(\d+)$` comme RegEx (champ 1) et `user/3` comme chaine à traiter (champ 2), puis de lire la description à droite).

# Ensuite, le challenge

Vous pouvez utiliser [ce lien O'Challenge](https://kourou.oclock.io/o-challenge/?ref=Ty1jbG9jay1uYXpjYS9zeW1mby1leG8tcmFwcGVscy1odHRwLW12Yy1waHAtSkItb2Nsb2NrfE8tY2xvY2stbmF6Y2F8c3ltZm8tZXhvLXJhcHBlbHMtaHR0cC1tdmMtcGhwLUpCfDIwMjMtMDItMTVUMDk6MDB8) pour créer un repo à partir des sources de JB

## .htaccess

Créer des redirections des URLs `/contact` et `/api` vers `/index.php?page=contact` et `/index.php?page=api`, via `.htaccess` comme indiqué dans l'exemple ci-dessus (ce sera plus simple, les redirections sont *statiques*). Pensez à tester les routes.

### Bonus avec une RegEx

* Utiliser une Regex afin de ne plus faire de redirections *statique* mais d'avoir qu'une redirection dynamique pour tout vos urls de bases (api, contact ...). Pour info, sur le challenge [regex101](https://regex101.com/), à partir du niveau 10 il vous est demandé de capturer des groupes, quand les regex sont utilisés dans le htaccess, les groupes capturés sont stockés et utilisables pour la redirection dans des variables `$1` (premier groupe capturé) `$2` (deuxième groupe) ...
* Ajouter une nouvelle URL à notre appli MVC, et rediriger les URLs du type `/contact/show/2` vers `index.php?page=contact&id=2`
* Cerise sur le gâteau, créer cette page :wink:
